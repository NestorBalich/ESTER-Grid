<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ESTER-GRID MVP</title>
<style>
  html, body {margin:0;padding:0;font-family:sans-serif;height:100%;display:flex;flex-direction:column;}
  h1 {margin:0;padding:10px;background:#111;color:#fff;font-size:2em;text-align:center;}

  #middle {flex:1;display:flex;overflow:hidden;}

  /* Izquierda: c√°mara + generar robot */
  #leftPanel {width:40%;background:#000;display:flex;flex-direction:column;align-items:center;padding:5px;box-sizing:border-box;}
  #camCanvas {flex:1;width:100%;background:#222;margin-bottom:10px;}

  /* Panel central vertical: robots arriba, colisiones abajo */
  #infoPanel {width:300px;background:#333;color:#fff;display:flex;flex-direction:column;overflow:hidden;padding:10px;box-sizing:border-box;font-family:monospace;}
  #robotList {height:150px;overflow:auto;padding-left:10px;background:#222;padding:5px;margin-bottom:10px;}
  #panel_collitions {flex:1;background:#111;color:#f66;overflow:auto;padding:5px;}
  #panel_status {flex:1;background:#111;color:rgb(17, 131, 36);overflow:auto;padding:5px;font-family:monospace;}

  /* Derecha: simulador */
  #simPanel {flex:1;background:#222;display:flex;align-items:center;justify-content:center;}
  #map, #camCanvas  {background:#333;width:95%;height:50%;} /* mitad del alto */

  /* Abajo: controles de objetos */
  #bottomPanel {background:#333;color:#fff;padding:10px;box-sizing:border-box;display:flex;gap:10px;flex-wrap:wrap;}
  #bottomPanel input, #bottomPanel button {padding:5px;}
  /* Bot√≥n overlay para ejecutar c√≥digo en fullscreen del simulador */
  #fullscreenRunBtn {position:fixed;top:12px;right:18px;z-index:10000;background:#ff8800;color:#fff;border:none;padding:10px 14px;font-size:14px;border-radius:6px;box-shadow:0 0 8px rgba(0,0,0,0.5);cursor:pointer;display:none;font-weight:bold;pointer-events:auto;}
  #fullscreenRunBtn:hover {background:#ff9900;}
</style>
</head>
<body>
<h1>ESTER - GRID Robotics üåê</h1>
<button id="fullscreenRunBtn" title="Ejecutar c√≥digo mientras el simulador est√° en pantalla completa">‚ñ∂ Ejecutar C√≥digo</button>

<div id="middle">
  <!-- Izquierda: c√°mara -->
  <!-- Panel de c√°mara + editor -->
<div id="leftPanel">
  <!-- Panel de IDE estilo Monaco -->
  <div id="editorPanel" style="flex:1;display:flex;flex-direction:column;margin-top:10px;width:100%;height:50%;">
   

   <div id="editorContainer" style="flex:1;border:1px solid #555;height:50%;">
    <div id="editor" style="width:100%;height:100%;"></div>
    </div>
    <br>
     <div id="editorButtons" style="display:flex;gap:5px;margin-bottom:5px;">
      <button id="runBtn">‚ñ∂ Ejecutar codigo</button>
      <button onclick="clearEditor()">üßπ Limpiar c√≥digo</button>
      <button onclick="clearOutput()">üßπ Limpiar consola</button>
      <button onclick="copyOutput()">üìã Copiar consola</button>
      <select id="selector">
        <option value="">‚¨ÜÔ∏è Cargar ejemplo...</option>
        <optgroup label="B√°sicos">
          <option value="ejemplo0">‚èπÔ∏è Mover cuadrado</option>
          <option value="ejemplo1">üõ∏ Teletransportar</option>
          <option value="ejemplo2">üõû Girar y avanzar</option>
        </optgroup>
        <optgroup label="Movimiento Individual">
          <option value="ejemplo3">Mover un robot</option>
        </optgroup>
        <optgroup label="Sincronizaci√≥n Multi-Robot">
          <option value="ejemplo4">ü§ù Mover dos robots</option>
          <option value="ejemplo5">üöë 4 robots chocando</option>
          <option value="ejemplo7_desincronizado">‚ö†Ô∏è Anti-patr√≥n: Desincronizaci√≥n</option>
          <option value="ejemplo8_sincronizado">‚úÖ Patr√≥n correcto: Sincronizaci√≥n</option>
        </optgroup>
        <optgroup label="Colaborativo">
          <option value="ejemplo9_mensajes">üì® Mensajes entre robots</option>
          <option value="ejemplo10_seguidor">üéØ Robot seguidor (Leader-Follower)</option>
        <option value="ejemplo6_emergente">üêç Comportamiento emergente serpiente</option>
        </optgroup>
        <optgroup label="Gemelos Digitales">
          <option value="ejemplo11_gemelos">üë• Modo Gemelo Digital</option>
        </optgroup>
      </select>
    </div>
    <div id="panel_output" style="height:40%;background:#111;color:#0f0;overflow:auto;padding:5px;margin-top:5px;font-family:monospace;white-space:pre-wrap;">
       # Salida de Python
    </div>
  </div>

</div>

  <!-- Panel central vertical: robots arriba, colisiones abajo -->
  <div id="infoPanel">
    <h4>Robots</h4>
    <ul id="robotList"></ul>

    <h4>Collitions</h4>
    <div id="panel_collitions"></div>
    <h4>Status <button onclick="clearStatus()" style="font-size:10px;padding:2px 5px;">üßπ Limpiar status</button></h4>
    <div id="panel_status"></div>
    <br>
    <div>
        <label>Objetos:</label>
        <input type="number" id="objCount" value="50" min="0" max="200"  style="width:50px;"/>
        <button id="regenBtn">Crear</button>
        <br> <br>
        <label>Escenario:</label>
        <select id="scenarioSelect">
          <option value="futbol" selected>F√∫tbol</option>
          <option value="laberinto">Laberinto</option>
          <option value="obstaculos">Obst√°culos</option>
          <option value="rescate">Rescate</option>
        </select>
        <br> <br>
    </div>
  </div>

    <!-- Derecha: simulador + c√°mara -->
   <div id="simPanel" style="flex:1;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;">
  <canvas id="map" width="900" height="600" style="border:1px solid #888;margin-bottom:10px;"></canvas>
  <canvas id="camCanvas" width="900" height="400" style="border:1px solid #888;background:#222;"></canvas>
</div>
</div>



<script src="/socket.io/socket.io.js"></script>
<script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.44.0/min/vs/loader.js"></script>
<script src="index.js"></script> <!-- ‚úÖ L√≥gica separada -->
<script>
// Bot√≥n solo ejecuta c√≥digo; visibilidad controlada desde index.js (enterSimFullscreen/exitSimFullscreen)
document.getElementById('fullscreenRunBtn').addEventListener('click', ()=>{ if(window.runCode) window.runCode(); });
</script>
</body>
</html>
